<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0f1624;
            color: white;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #1a2332;
            border-radius: 8px;
        }
        h2 {
            color: #ff6b35;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #10b981; }
        .error { background: #ef4444; }
        .info { background: #3b82f6; }
        video {
            width: 100%;
            max-width: 400px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üé• –¢–µ—Å—Ç: –£—Å–ª–æ–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ</h1>
    
    <div class="test-section">
        <h2>üì± –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h2>
        <div id="device-info"></div>
    </div>

    <div class="test-section">
        <h2>üé¨ –í–∏–¥–µ–æ —Å data-src (–ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)</h2>
        <video id="hero-video" muted loop playsinline preload="none" poster="/images/ship.webp">
            <source data-src="/video/compress-hero-video.webm" type="video/webm" />
            <source data-src="/video/compress-hero-video.mp4" type="video/mp4" />
        </video>
        <div id="video-status"></div>
    </div>

    <div class="test-section">
        <h2>üìä –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã</h2>
        <div id="resources"></div>
    </div>

    <script>
        // 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        const isDesktop = window.matchMedia('(min-width: 768px)').matches;
        const isMobile = !isDesktop;
        const userAgent = navigator.userAgent;
        const isReactSnap = userAgent.includes('ReactSnap');

        document.getElementById('device-info').innerHTML = `
            <div class="status info">
                <strong>–®–∏—Ä–∏–Ω–∞ —ç–∫—Ä–∞–Ω–∞:</strong> ${window.innerWidth}px<br>
                <strong>–¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</strong> ${isDesktop ? 'üíª Desktop/Tablet' : 'üì± Mobile'}<br>
                <strong>UserAgent:</strong> ${userAgent.substring(0, 80)}...<br>
                <strong>ReactSnap:</strong> ${isReactSnap ? '–î–∞' : '–ù–µ—Ç'}
            </div>
        `;

        // 2. –£—Å–ª–æ–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ (—Ç–æ–ª—å–∫–æ –Ω–∞ desktop)
        const video = document.getElementById('hero-video');
        const statusDiv = document.getElementById('video-status');

        if (isReactSnap) {
            statusDiv.innerHTML = `<div class="status info">‚è∏Ô∏è ReactSnap –æ–±–Ω–∞—Ä—É–∂–µ–Ω - –≤–∏–¥–µ–æ –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è</div>`;
        } else if (isMobile) {
            statusDiv.innerHTML = `<div class="status success">‚úÖ Mobile —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ - –≤–∏–¥–µ–æ –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (—ç–∫–æ–Ω–æ–º–∏—è ~3.8 –ú–ë)</div>`;
        } else {
            statusDiv.innerHTML = `<div class="status info">‚è≥ Desktop/Tablet - –∑–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ...</div>`;
            
            // –ö–æ–ø–∏—Ä—É–µ–º data-src –≤ src
            const sources = video.querySelectorAll('source');
            sources.forEach(source => {
                const dataSrc = source.getAttribute('data-src');
                if (dataSrc) {
                    source.setAttribute('src', dataSrc);
                }
            });
            
            video.load();
            
            video.addEventListener('loadeddata', () => {
                statusDiv.innerHTML = `<div class="status success">‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é</div>`;
                video.play();
            });
            
            video.addEventListener('error', () => {
                statusDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ</div>`;
            });
        }

        // 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
        setTimeout(() => {
            const resources = performance.getEntriesByType('resource');
            const videoResources = resources.filter(r => r.name.includes('video/'));
            
            const resourcesDiv = document.getElementById('resources');
            
            if (videoResources.length === 0) {
                resourcesDiv.innerHTML = `<div class="status success">‚úÖ –í–∏–¥–µ–æ —Ñ–∞–π–ª—ã –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω—ã - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!</div>`;
            } else {
                const resourceList = videoResources.map(r => {
                    const size = (r.transferSize / 1024).toFixed(1);
                    return `<li>${r.name.split('/').pop()} - ${size} –ö–ë</li>`;
                }).join('');
                
                resourcesDiv.innerHTML = `
                    <div class="status info">üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤: ${videoResources.length}</div>
                    <ul>${resourceList}</ul>
                `;
            }
        }, 2000);
    </script>
</body>
</html>
